## ‘동선 그래프’로 뽑는 관광코스 추천

- **목표**: 실제 방문자의 동시혼잡·연속방문 패턴을 그래프로 모델링하여, 자연스러운 관광 코스(2~5 스폿)를 자동 추천하고 매출·체류시간 증대를 돕는 인사이트 제공
- **핵심 산출물**: 인터랙티브 지도(히트맵+그래프 엣지), 코스 카드(UI), 영향권(버퍼) 시각화, 전후 비교(행사/시즌)

---

### 1) 문제정의 및 스토리라인
- **문제**: 방문자 수만 많아도 ‘좋은 코스’는 아닙니다. 실제로는 “함께 들르는 곳들”이 중요한데, 이를 데이터 기반으로 체계화한 지표/시각화가 부족합니다.
- **아이디어**: 같은 시간대에 함께 붐비는 관광지 쌍을 연결해 **동선 그래프**를 만들고, 그래프 커뮤니티에서 자연스러운 코스 묶음을 추출합니다. 야간·주말 가중, 업종 결합(식음료 ↔ 관광지)으로 현실성 강화.
- **활용 장면**: 코스 추천 카드 제공(가족/커플/야간 등 테마), 행사 시 코스 재배치, 안내사인/셔틀/노면표식 우선 구간 선정, 상권 협업 마케팅.

---

### 2) 데이터 자산 및 매핑 키
- **소스**
  - `data/3_관광지분석_삼성카드.xlsx`: 관광지별 매출/업종 비중, 시간대/요일 패턴
  - `data/3_관광지분석_LG유플러스.xlsx`: 시간대별 체류/유동인구(가정), 혼잡도 추정
  - `data/4_관광지트렌드분석_(LGU+/삼성)`: 시즌성·증감 추세
  - `data/5_식품위생업소소비분석_(경기데이터드림/삼성카드)`: F&B, 카페, 디저트 등 결합 노드
  - `data/1_생활인구분석_(LGU+/경기데이터드림)`: 상주/방문 분리, 야간경제 잠재력 가중
- **매핑 키 설계**
  - 공간 키: 행정코드 + 좌표(센트로이드) + 관광지 ID(정규화 테이블)
  - 시간 키: `YYYY-MM-DD hh(시간대)`, 요일, 주차, 공휴일 플래그
  - 업종 키: 대분류/중분류 표준화(식음료·체험·문화·쇼핑)

---

### 3) 전처리 파이프라인
1. 스팟 정규화: 관광지·F&B 스팟 테이블 생성(`spot_id`, 이름, 좌표, 카테고리)
2. 시간 피벗: 월/요일/시간대 기준으로 체류인구·매출 집계
3. 보정: 주변 상주인구·점포 수로 정규화(혼잡 대비 거래 효율)
4. 가중: 주말×1.2, 야간(20~02시)×1.3 등 시나리오별 가중치 프로필 지원
5. 이상치 처리: 변화점 탐지로 이벤트 구간 태깅(행사 효과 분석에 사용)

---

### 4) 지표 정의
- **동시혼잡 점수 C(i,j)**: 같은 시간창에서 두 스팟의 동시 혼잡 상관/공출현 빈도(시간창=1시간/2시간 가변)
- **연속방문 점수 S(i→j)**: `t`와 `t+Δt`에서 i→j 순차적 피크/매출 연계 강도
- **결합 매력도 A(i,j)**: C와 S를 결합하고 업종 시너지(예: 관광지→카페 +) 가중
- **코스 가치 V(path)**: 경로 내 체류가치(야간·주말 가중) × 객단가 × 다양성(업종 엔트로피)

수식(개념):
- \[ C(i,j) = corr(occupancy_i, occupancy_j)_{동시간창} + λ·cooccur(i,j) \]
- \[ S(i→j) = P(visit\\ j\\ at\\ t+Δ | visit\\ i\\ at\\ t) \]
- \[ A(i,j) = w_c·C + w_s·S + w_u·synergy(category_i, category_j) \]
- \[ V(path) = f(체류가치, 객단가, 업종다양성, 이동동선길이제약) \]

---

### 5) 그래프 생성 및 코스 추출 알고리즘
- **그래프 구성**: 노드=스팟, 엣지 가중치=결합 매력도 A(i,j)
- **커뮤니티 탐지**: Louvain/Leiden으로 자연스러운 그룹 추출(코스 후보의 재료)
- **시퀀스 마이닝**: 상위 엣지로 가중 그래프에서 최대 3~5개 노드의 경로 탐색(중복·순환 방지)
- **혼잡 회피**: 실시간/최근 혼잡을 벌점으로 반영해 대안 코스도 함께 제시
- **간단한 ML 설명**: 그래프 커뮤니티는 “서로 자주 어울리는 친구 무리 찾기”, 시퀀스는 “자연스러운 이동 순서 찾기”예요.

---

### 6) 시각화 및 UX
- **메인 지도**: 히트맵(체류/매출) + 엣지(투명도=신뢰도, 두께=A(i,j))
- **코스 카드**: 3가지 테마(가족·커플·야간경제), 각 카드에 예상 체류시간, 예상 소비, 대표 사진, 대체안 1개
- **툴팁**: 노드 Hover 시 업종 비중, 피크 시간, 객단가; 엣지 Hover 시 C/S/A 구성값
- **타임 필터**: 월/요일/시간 슬라이더, 행사 주간 토글
- **영향권**: 5~10분 보행 버퍼로 상권 파급 시각화
- **결과 이미지**: `task/image.png` 스타일로 지도+그래프+카드 합성(공모전 제출판)

---

### 7) 기술 스택
- **데이터/백엔드**
  - Python: `pandas`, `polars`(선택), `numpy`
  - 그래프/ML: `networkx` 또는 `igraph`, `python-louvain`/`leidenalg`, `scikit-learn`, `ruptures`(변화점)
  - 공간: `geopandas`, `shapely`, `pyproj`; DB는 `PostgreSQL + PostGIS`(선택)
  - API: `FastAPI`(코스 추천, 타일/GeoJSON 제공)
- **프런트/시각화**
  - 웹: `React + Vite` 또는 `Next.js`
  - 지도: `deck.gl + Mapbox GL JS` 또는 `Kepler.gl`(빠른 프로토타입)
  - 차트: `ECharts`/`Vega-Lite`
- **배포/운영**
  - Docker 컨테이너(백/프런트 분리), Nginx 리버스 프록시
  - PowerShell 스크립트로 로컬 실행(주의: `&&` 대신 줄바꿈 또는 `;`)

초등설명(한 줄): 그래프는 “장소들을 점으로 놓고, 같이 자주 가면 선을 굵게 그리는 그림”이에요.

---

### 8) 시스템 아키텍처(개념)
- 파이프라인: 원천데이터 → 정규화/피벗 → 지표(C,S,A,V) 계산 → 그래프/코스 추출 → GeoJSON/타일 → 프런트 지도 렌더링
- API 엔드포인트 예시
  - `GET /api/spots?time=...` 스팟 메타/지표
  - `GET /api/graph?time=...` 엣지 리스트(A,C,S 분해값)
  - `GET /api/courses?theme=...&time=...` 추천 코스 카드(경로, 요약지표)

---

### 9) 파일 구조 제안(프로토타입)
```
/etl
  01_normalize_spots.ipynb
  02_build_timeseries.ipynb
  03_build_graph.ipynb
  04_recommend_courses.ipynb
/backend
  app.py (FastAPI)
  services/
    graph_builder.py
    course_recommender.py
  data/
    spots.parquet
    graph_edges.parquet
/frontend
  src/
    pages/
    components/MapView.tsx
    components/CourseCard.tsx
    lib/api.ts
/task
  idea.md
  image.png
```

---

### 10) 평가/검증
- 백테스트: 특정 기간 학습 → 다음 기간 코스의 실제 매출/체류 변화 검증
- A/B 개념: 코스 추천 노출 지역 vs 비노출 지역 비교(가능 시)
- 휴리스틱 베이스라인: 단순 상위 방문량/매출 코스 대비 개선율 제시

---

### 11) 리스크 및 대응
- 데이터 스키마 불일치: 키 정규화 테이블 별도 관리
- 프라이버시: 집계 단위 유지(개인 이동 경로 불사용)
- 노이즈/행사 영향: 변화점 태깅, 이벤트 주간 별도 모델
- 성능: 그래프는 지역/시간 단위로 샤딩, 클라이언트는 엣지 샘플링/타일링

---

### 12) 일정(2주 스프린트 예시)
- D1~D2: 스키마 정리·정규화, 피벗(월/요일/시간)
- D3~D5: 지표(C,S,A) 계산, 그래프·커뮤니티, 경로 추출
- D6~D8: API(FastAPI) + 프런트 지도(deck.gl) 프로토타입
- D9~D10: 코스 카드/테마, 이미지 합성(`task/image.png` 기반)
- D11~D12: 튜닝(가중치, 혼잡 패널티), 리포트/대시보드
- D13~D14: 폴리싱·발표자료 제작·리허설

---

### 13) 공모전 제출물 구성 제안
- 1장 요약 인포그래픽: 지도(히트맵+그래프)+코스 카드 3종+핵심 지표
- 4~6장 스토리: 문제정의 → 방법 → 결과 → 정책/상권 제안 → 행사 효과
- 부록: 지표 정의와 간단 ML 설명(초등학생도 이해 가능 문구 포함)

---

### 14) 다음 단계(실행)
- `3_관광지분석_삼성카드.xlsx`/LGU+를 우선 사용해 스팟 테이블 작성
- 시간축 정렬 후 C/S/A 산출 및 Top 엣지 100개 샘플링
- 코스 3개(가족/커플/야간) 생성 → 이미지 합성 → 제출용 데모
